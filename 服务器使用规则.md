# 服务器使用规则

服务器是我们大家共同的财产，需要大家共同来维护。

管理员负责服务器的资源调配和服务器日常维护

# 服务器硬件软件配置

| 系统      | Ubuntu 20.04                                            |
| --------- | ------------------------------------------------------- |
| CPU       | i9-13900K                                               |
| 电脑内存  | 128g                                                    |
| GPU       | 2 * Nvidia RTX4090                                      |
| GPU内存   | 24g*2                                                   |
| CUDA      | cuda-10.2 ， cuda-11.3                                  |
| Anaconda  | 各用户自行安装                                          |
| pytorch等 | 各用户自行安装(注意：安装**对应****cuda**版本的pytorch) |

# 硬盘挂载位置

1. SSD盘挂载到根目录下` /` ，作为系统盘
2. 机械硬盘16T划分为两个盘：
   1. 2T 挂载到 `/data` ，用来存储公开数据
   2. 14T挂载到`/home` ，用于供用户使用

注意：服务器重启后可能存在硬盘未挂载的情况，请联系管理员挂载硬盘。

# 用户建立

- 服务器不默认给团队所有成员建立用户，团队内人员需要使用时向管理员打招呼，由管理员申请建立用户。
- 团队外的人员在服务器建立用户，需要团队内同学代替其向管理员申请，并说明用途。
- 用户名为申请人员拼音全拼，密码由申请人提供给管理员设置

# 使用服务器需要具备的能力：

1. 熟悉linux系统
2. 熟练使用常用的linux命令
3. 熟悉linux环境下深度学习环境的搭建过程
4. 学会使用Vim编辑器，服务器进程管理等命令
5. 对自己的训练任务所需内存了解，不要挤掉他人的训练任务
6. 服从并遵守服务器管理规定，听从服务器管理员的建议

# 关于权限

为了方便管理和数据安全，我们只分配给服务器管理员sudo(root)权限

普通用户不享有sudo权限。

# 关于硬盘使用

1. 为了节约硬盘使用，管理员在`/data`路径下存储了常用的公开数据集，大家可以直接调用数据集，但是无写入权限，**建议可以通过****软连接****的形式**，链接到自己的目录下使用。
2. 每位同学及时清理自己不需要的文件，每位用户使用容量不超过2T

# 关于网络问题

1. 受中间frp服务器影响，服务器流量带宽为1M，能够满足大家日常远程调用。
2. 远程外网调用服务器禁止上传或者下载超出2G的数据
3. 学校内连接服务器不受带宽限制，可以传输数据，但是流量耗费较大，若在同一网段下，则不耗费流量

# 普通用户使用cuda

由于普通用户无sudo权限，因此无法自行安装cuda

服务器管理员在服务器上预先安装了cuda-10.2 cuda-11.3版本的cuda

如果必须使用其他版本的cuda，请联系管理员安装，并说明为什么使用

普通用户可以使用，使用方法为：普通用户只需修改自己的环境变量，将已安装的cuda路径映射到自己的环境变量中即可，具体如下：

1. 进入目录下，查看有什么版本的cuda

```Bash
(base) wt@wt-Ubuntu:~$ cd /usr/local
(base) wt@wt-Ubuntu:/usr/local$ ls
bin  cuda  cuda-11.3  etc  games  include  lib  man  sbin  share  src
```

1. 修改个人用户环境变量

```Bash
vim ~/.bashrc
```

在文件尾部添加相应路径：(其中cuda-10.1请修改为自己对应的版本，例如cuda-10.2 cuda-11.7 等)

```Bash
export PATH="/usr/local/cuda-11.3/bin:$PATH"
export LD_LIBRARY_PATH="/usr/local/cuda-11.3/lib64/:$LD_LIBRARY_PATH"
```

:wq 保存退出

1. 更新环境变量

```Bash
source ~/.bashrc
```

1. 查看nvcc版本，测试是否成功

```Bash
nvcc -V
```

![img](https://i45guarx24.feishu.cn/space/api/box/stream/download/asynccode/?code=NDg2OTZlZjk3MGFkYWNmMjM4ZDMzODEwNjYwMDBiNTVfY0FUajNhTDhteG8wTHFPa2tlZnhwSmZqQ2FOZ1lTenhfVG9rZW46WnEzemI2Snlyb2tUdkd4bUU0OGNKTmJ5blVkXzE2ODMxNjgxMjI6MTY4MzE3MTcyMl9WNA)

# 训练模型

1. **监督自己的训练任务**
   1. 训练模型之前要使用`nvidia-smi`命令来查看显卡目前的使用情况，
   2. 若`nvidia-smi`命令失效，则联系管理员查看显卡驱动情况
   3. **要了解自己训练任务大致所用的内存，不要挤掉别人的训练任务。**
2. **停止自己的训练任务**

中途停止自己的训练任务按 `Ctrl+C`，不要按`Crtl+Z`

1. **建议**

单卡训练优先使用2卡进行训练，1卡可能会被其他同学默认用来debug，防止任务被挤掉